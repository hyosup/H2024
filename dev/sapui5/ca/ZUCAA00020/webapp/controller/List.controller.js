sap.ui.define(["hkmc/ca/zucaa00020/controller/BaseController","hkmc/ca/zucaa00020/model/formatter","sap/ui/model/json/JSONModel"],function(e,t,i){"use strict";return e.extend("hkmc.ca.zucaa00020.controller.List",{formatter:t,onInit:function(){this._oList=this.byId("idTree");this._aSelectedIndices=[];this._sVersion="";this.getModel().setSizeLimit(200);this.getRoute("RouteList").attachPatternMatched(this._onObjectTreeListMatched,this);this.getRoute("RouteContents").attachPatternMatched(this._onObjectContentListMatched,this);this.getRoute("RouteSearchContents").attachPatternMatched(this._onObjectSearchListMatched,this)},_onObjectTreeListMatched:function(e){this._bindTree(2)},_onObjectContentListMatched:function(e){this._oParameter=e.getParameter("arguments");this._sVersion=this._oParameter.version;this.setViewConfig("/listLanguage",this._oParameter.spras);var t=this.byId("idTree");if(!t.getBinding("items")){this._bindTree(2)}this.setViewConfig("/layout",sap.f.LayoutType.TwoColumnsMidExpanded)},_onObjectSearchListMatched:function(e){var t=this.getModel();this._oParameter=e.getParameter("arguments");this._sVersion=this._oParameter.version;this.setViewConfig("/listLanguage",this._oParameter.spras);var i=this.byId("idTree"),s=this.getModel().createKey("/TreeSet",{NodeId:this._oParameter.node_id,Version:this._sVersion,Spras:this.getViewConfig("/listLanguage")});t.read(s,{success:function(e,t){this._aSelectedIndices=e.NodePath.split(">");this._bindTree(0)}.bind(this)});this.setViewConfig("/layout",sap.f.LayoutType.TwoColumnsMidExpanded)},handleVersionChange:function(e){var t=e.getParameter("selectedItem").getKey();if(this._sVersion!==t){this._sVersion=t;this._bindTree(2)}},_bindTree:function(e){var t=[];var i=this.byId("idTree");t.push(new sap.ui.model.Filter("Version",sap.ui.model.FilterOperator.EQ,this._sVersion));t.push(new sap.ui.model.Filter("Spras",sap.ui.model.FilterOperator.EQ,this.getViewConfig("/listLanguage")));i.bindItems({path:"/TreeSet",mode:"SingleSelectMaster",parameters:{countMode:"Inline",numberOfExpandedLevels:e},filters:t,template:new sap.m.StandardTreeItem({title:"{Title}",tooltip:{path:"NodeType",formatter:this.formatter.formatTreeTooltip},icon:{parts:[{path:"NodeType"},{path:"Zdel"}],formatter:this.formatter.formatTreeIcon}})})},handleItemPress:function(e){var t=e.getSource().getSelectedItem().getBindingContext().getPath(),i=this.getViewModel().getProperty(t);if(i.Zlevel==="0"){this.setViewConfig("/layout",sap.f.LayoutType.OneColumn);return}if(i.NodeType==="expanded"){this.setViewConfig("/layout",sap.f.LayoutType.OneColumn);return}this.setViewConfig("/layout",sap.f.LayoutType.TwoColumnsMidExpanded);this._sVersion=i.Version;this.getRouter().navTo("RouteContents",{node_id:i.NodeId,version:encodeURIComponent(this._sVersion),spras:i.Spras},false)},handleSearch:function(e){var t=this.byId("idVersionComboBox").getSelectedItem(),i=e.getParameter("query");if(i.length>0){this.setViewConfig("/layout",sap.f.LayoutType.OneColumn);this._sVersion=t?t.getKey():"";this.getRouter().navTo("RouteSearch",{version:encodeURIComponent(this._sVersion),spras:this.getViewConfig("/listLanguage"),query:{search_str:encodeURIComponent(i)}},false)}},handleDisplayLog:function(){var e=this.getResourceBundle();if(!this.oDialog){this.oDialog=new sap.m.Dialog({type:sap.m.DialogType.Message,title:e.getText("displayLog"),content:[new sap.m.Label,new sap.m.TextArea("confirmationNote",{width:"100%",editable:false,rows:10})],endButton:new sap.m.Button({text:e.getText("close"),press:function(){this.oDialog.close()}.bind(this)})})}var t=this.byId("idVersionComboBox").getSelectedItem(),i=this.getModel().createKey("/VersionListSet",{Version:t.getKey(),Spras:this.getViewConfig("/listLanguage")});this.getModel().read(i,{success:function(e){this.oDialog.getContent()[0].setText(t.getText());this.oDialog.getContent()[1].setValue(e.Zdesc);this.oDialog.open()}.bind(this)})},onUpdateFinished:function(e){var t=this._oList.getItems();var i=this.getViewModel();for(var s=0;s<t.length;s++){var o=i.getProperty(t[s].getBindingContext().getPath());if(this._aSelectedIndices[0]===o.NodeId){this._aSelectedIndices.splice(0,1);if(!t[s].isLeaf()){this._oList.expand(this._oList.indexOfItem(t[s]))}else{t[s].setSelected(true);var n=t[s].getDomRef();this.byId("idScroll").scrollTo(0,n.getBoundingClientRect().y,2e3)}break}}},handleLanguChange:function(e){this._bindTree(2)}})});